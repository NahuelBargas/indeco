---
title: " Indicadores Económicos "
output:
  flexdashboard::flex_dashboard:
     includes:
       in_header: header.html
     theme : yeti
     orientation : rows 
     css : coloresbotones.css
     self_contained : TRUE
     navbar:
       - { title: "Consultas y comentarios", href: "http://nahuelbargas.github.io/indeco/index.html", align: right}
---



```{r setup, include=FALSE}

Sys.setlocale("LC_TIME","Spanish") #para que los meses al abreviarlos no tengan un punto al final


# Librerías

library(highcharter)
library(flexdashboard)
library(openxlsx)
library(zoo)
library(knitr)
library(kableExtra)
library(viridisLite)
library(tidyverse)
library(mFilter)
library(treemap)
library(jsonlite)
library(DT)
library(reactable)
library(htmltools)
library(stringr)
library(jsonlite)



# Bases

## IPC

ipcmensual<- read.xlsx("bases/indicadores.xlsx", sheet=1,detectDates = TRUE)
ipcmensualdiv<-read.xlsx("bases/indicadores.xlsx", sheet=2)
colnames(ipcmensualdiv)[1]<-""
ipcintdiv<-read.xlsx("bases/indicadores.xlsx", sheet=3)
colnames(ipcintdiv)[1]<-""

aperturas <- read.xlsx("bases/indicadores.xlsx", sheet="Aperturas")

aperturas <- aperturas %>% pivot_longer(cols=-Aperturas,names_to="Region", values_to= "variación_mensual")

## Gini

gini_ts<-readRDS("bases/basegini.RDS")

trimestre<-seq(as.Date("2016-04-01"), length = 24,by = "3 months")
trimestre2<-as.yearqtr(trimestre)
trimestre2 <-format(trimestre2,  "%q-%Y")

gini_ts3<-data.frame(trimestre,trimestre2,gini_ts[,1:3])


## PIB

producto<-read.xlsx("bases/indicadores.xlsx", sheet=4,detectDates = TRUE)

producto$Fecha <- as.yearqtr(2004 + seq(0, 73)/4)
producto$Fecha <-format(producto$Fecha,  "%q %Y")
producto$fecha1<-seq(as.Date("2004-01-01"), length = 74, by = "3 months")
producto$fecha2<-format(as.yearqtr(2004 + seq(0, 73)/4),  "%q %Y")
producto$fecha3<-paste(producto$Año,"-",producto$Trimestre)

PBI.ts<-ts(producto$PIB.DESEST, frequency = 4, start = c(2004, 1))
PBI.hp<-hpfilter(PBI.ts,type="lambda", freq=1600, drift=FALSE)
producto.ts<-ts(producto[,3:4], frequency = 4, start = c(2004, 1))
producto.ts<-cbind(producto.ts,PBI.hp$trend)

## Comercio

basezonas<-read.xlsx("bases/basezonas27.xlsx", sheet=1)

saldozonas<-read.xlsx("bases/indicadores.xlsx", sheet=7)

export<-read.xlsx("bases/indicadores.xlsx", sheet="Expo-ICA")
import<-read.xlsx("bases/indicadores.xlsx", sheet="Impo-ICA")

## Valor agregado bruto

VAB<-read.xlsx("bases/indicadores.xlsx", sheet="VAB")

## EMAE

emae<- read.xlsx("bases/indicadores.xlsx", sheet="EMAE",detectDates = TRUE)

## Resultado fiscal
basecaja<-read.xlsx("bases/resultado_fiscal_agosto_2022.xlsx", sheet=2,startRow = 7,colNames=FALSE)
basecaja<-basecaja[,c(1,2,5)]
names(basecaja)<-c("Concepto","Monto", "Var Anual")

## Origen Exportaciones

argentina<-jsonlite::fromJSON("bases/argentina.geo.json", simplifyVector = FALSE)

regiones<-read.xlsx("bases/opex 2ndo semestre 2021.xlsx",sheet=1)

provincias<-jsonlite::fromJSON("bases/provincias.geojson", simplifyVector = FALSE)

complejos<-read.xlsx("bases/opex 2ndo semestre 2021.xlsx",sheet=2)




# Colores utilizados en los próximos gráficos

cols <- plasma(4,alpha=0.8,direction=-1)
cols2<- c("Coeficiente de Gini" = "red", "Intervalos de  Confianza-95%" = "lightblue")
cols3 <- plasma(3,alpha=0.8,direction=-1)
cols4<- c("PIB" = cols3[1], "PIB desestacionalizado" = cols3[2], "PIB tendencia" = cols3[3])
cols5<- c("PIB" = "yellow3", "PIB desestacionalizado" = "hotpink4", "PIB tendencia" = "navyblue")
cols6<- c("lightblue", "red")
cols7 <- plasma(3,alpha=0.8)
cols8 <- plasma(17,alpha=0.8)


cols9 <- viridis(20,alpha=0.8,direction=-1)

cols9 <- substr(cols9, 0, 7)

cols10<-plasma(6, alpha=0.8,direction=-1)
cols11<-viridis(6, alpha=0.8,direction=-1)
cols12<-viridis(12, alpha=0.8)

##usar scales::show_col(cols13) para previsualizar los colores

cols13<-inferno(7, alpha=0.8, direction=-1)

cols14<-substring(viridis(5,dir= -1), 0, 7)

cols15<-substring(plasma(20,dir= -1), 0, 7)

coloresAperturas<- viridis(7, alpha=0.8,direction=1)

```

```{r opc  hc, include=FALSE}
hcopts <- getOption("highcharter.lang")


hcopts$drillUpText<- "Volver"
hcopts$downloadCSV <- "Descargar CSV"
hcopts$downloadJPEG <- "Descargar imágen JPEG"
hcopts$downloadPDF <- "Descargar documento PDF"
hcopts$downloadPNG  <- "Descargar imágen PNG"
hcopts$downloadSVG  <- "Descargar imágen SVG"
hcopts$downloadXLS  <- "Descargar XLS"
hcopts$loading  <- "Procesando..."
hcopts$months<-c("Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre")
hcopts$noData <- "No existen datos para mostrar"
hcopts$numericSymbols <-c("mil", "M", "G", "T", "P", "E") 
hcopts$printChart <- "Imprimir Gráfico"
hcopts$shortMonths<-c("Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic")
hcopts$resetZoom <- "Restablecer zoom"
hcopts$resetZoomTitle <- "Restablecer nivel del zoom 1:1"
hcopts$thousandsSep <- ","
hcopts$viewData <- "Mostrar tabla de datos"
hcopts$viewFullscreen <- "Ver en pantalla completa"
hcopts$exitFullscreen <- "Salir de la pantalla completa"
hcopts$contextButtonTitle<- "Ver opciones"


options(highcharter.lang = hcopts)

# Anado un tema por default para los gráficos en highcharter:
temaclásico<- hc_theme(
  colors = c("#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"),
  chart = list(
    backgroundColor = "white"
  ))


```


Serie histórica del Nivel General-IPC-INDEC {data-navmenu="Índice de precios al consumidor e Ingresos"}
=========================================

Rows {data-height=150}
-------------------------------------

### Mensual

```{r}
valueBox(paste(format(last(ipcmensual$IPC.General),digits=2),"%"), caption = paste0("Variación mensual del IPC - ",str_to_title(format(max(ipcmensual$Período),"%B-%Y"))), icon="glyphicon-arrow-up",color="skyblue")
```

### Interanual


```{r}
valueBox(paste(ipcintdiv[1,2],"%"), caption = "Variación interanual", icon="glyphicon-arrow-up",color="orangered")
```

### Acumulada en el año.

```{r}
valueBox("56.4 %", caption = "Acumulada en lo que va del año",  color="yellow")
```


Rows {data-height=850}
---------------------------------------------------------------

### Serie histórica del Nivel General, IPC Núcleo, Estacional y Regulados

```{r gráfico1}

highchart() %>% 
  hc_add_series(ipcmensual, "column", hcaes(x = Período, y =IPC.General ),name="Nivel General")%>%
  hc_add_series(ipcmensual, "line", hcaes(x = Período, y =Estacional ),name="Estacional")%>%
  hc_add_series(ipcmensual, "line", hcaes(x = Período, y =Nucleo ),name="IPC Núcleo")%>%
  hc_add_series(ipcmensual, "line", hcaes(x = Período, y =Regulados ),name="Regulados")%>%
  hc_xAxis(type = "datetime")%>%
  hc_yAxis(title=list(text = "Porcentaje"))%>%    
  hc_tooltip(pointFormat =  "{series.name} <br>
  {point.y} %", crosshairs = TRUE) %>%
  hc_plotOptions(series=list(states=list(inactive=list(opacity= 0.6))))%>%
  hc_colors(cols)%>%
  hc_credits(enabled = TRUE, text = "Fuente: INDEC.",align = "right",verticalAlign = "bottom",
  style = list(color = "#2b908f", fontSize = '10px'),
             href = " https://www.indec.gob.ar/ftp/cuadros/economia/sh_ipc_09_22.xls")%>%		 
    hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)
```


Variación mensual e Interanual del IPC-INDEC por región   {data-navmenu="Índice de precios al consumidor e Ingresos"}
==================================================


Row {.tabset .tabset-fade}
-----------------------------

### `r paste0("Variación mensual según divisiones","-",str_to_title(format(max(ipcmensual$Período),"%b-%y"))) `


```{r tabla1, include=FALSE, eval=FALSE}
kable(ipcmensualdiv) %>%
kable_styling(bootstrap_options = c("bordered","responsive")) %>%
  add_header_above(c(" " = 2, "Regiones" = 6))%>%
row_spec(1, bold = T, color = "white", background = "lightseagreen")%>%
footnote("INDEC",general_title="Fuente: ",footnote_as_chunk = F, title_format = c("italic", "underline"),fixed_small_size= T)

ipcmensualdiv%>% 
 downloadthis::download_this(
    output_name = "Variación mensual según divisiones",
    output_extension = ".xlsx",
    button_label = "Descargar la tabla en formato xlsx",
    button_type = "info",
    self_contained = FALSE, 
    has_icon = FALSE 
  )

```

```{r tabla1react,}

colnames(ipcmensualdiv)[1]<-"Divisiones"

ipcmensualdivreact<-ipcmensualdiv


for (i in 1:13) {
ipcmensualdivreact$Divisiones[i]<- paste0("<span title=","'",ipcmensualdiv$Divisiones[i],"'",">", ipcmensualdiv$Divisiones[i], "</span>")
}


ipcmensualdivreact$Divisiones[1]<- "<span style =  'background : lightseagreen ;fontWeight : bold;  color : white' ><span title='Nivel General'>Nivel General</span> </span>"



sticky_style <- list(position = "sticky", left = 0, background = "lightseagreen", zIndex = 1,color = "white",
                     borderRight = "1px solid #eee")

sticky_styleh <- list(position = "sticky", left = 0, background = "#fff", zIndex = 1,
                     borderRight = "1px solid #eee")

reactable(
  ipcmensualdivreact,
pagination = FALSE,
   highlight = TRUE,
   wrap = FALSE,
compact = TRUE,
columns = list(
    Divisiones = colDef(
	  html = TRUE,
      style = sticky_style,
      headerStyle = sticky_styleh
    )
  ),
columnGroups = list(
    colGroup(name = "Regiones", 
columns = c("GBA","Pampeana","Noreste","Noroeste","Cuyo","Patagonia"))),
rowStyle = function(index) {
  if (index == 1) list(fontWeight = "bold",color="white",background = "lightseagreen")
})



```

### `r paste0("Variación interanual según divisiones","-",str_to_title(format(max(ipcmensual$Período),"%b-%y"))) `


```{r tabla2, include=FALSE,eval=FALSE}
kable(ipcintdiv) %>%
kable_styling(bootstrap_options = c("bordered","responsive")) %>%
add_header_above(c(" " = 2, "Regiones" = 6))%>%
row_spec(1, bold = T, color = "white", background = "orangered")%>%
footnote("INDEC",general_title="Fuente: ",footnote_as_chunk = F, title_format = c("italic", "underline"),fixed_small_size= T)

ipcintdiv%>% 
 downloadthis::download_this(
    output_name = "Variación interanual según divisiones",
    output_extension = ".xlsx",
    button_label = "Descargar la tabla en formato xlsx",
    button_type = "info",
    self_contained = FALSE, 
    has_icon = FALSE 
  )
```

```{r tabla2react, }

colnames(ipcintdiv)[1]<-"Divisiones"

ipcintdivreact<-ipcintdiv


for (i in 1:13) {
ipcintdivreact$Divisiones[i]<- paste0("<span title=","'",ipcintdiv$Divisiones[i],"'",">", ipcmensualdiv$Divisiones[i], "</span>")
}

ipcintdivreact$Divisiones[1]<- "<span style =  'background : darkorange ;fontWeight : bold;  color : white' ><span title='Nivel General'>Nivel General</span> </span>"

sticky_style <- list(position = "sticky", left = 0, background = "darkorange", zIndex = 1,color = "white",
                     borderRight = "1px solid #eee")

sticky_styleh <- list(position = "sticky", left = 0, background = "#fff", zIndex = 1,
                     borderRight = "1px solid #eee")


reactable(
  ipcintdivreact,
pagination = FALSE,
   highlight = TRUE,
   wrap = FALSE,
compact = TRUE,
columns = list(
    Divisiones = colDef(
	  html= TRUE,
      style = sticky_style,
      headerStyle = sticky_styleh
    )
  ),
columnGroups = list(
    colGroup(name = "Regiones", 
columns = c("GBA","Pampeana","Noreste","Noroeste","Cuyo","Patagonia"))),
rowStyle = function(index) {
  if (index == 1) list(fontWeight = "bold",color="white",background = "darkorange")
})




```

```{css}
.col-1-3.mobile-col-1-1 {
    height: 400px;
}
```

Variación mensual del IPC-INDEC . Aperturas seleccionadas de la división Alimentos y bebidas no alcohólicas    {data-navmenu="Índice de precios al consumidor e Ingresos"}
====================================================================================================


Column {.tabset .tabset-fade}
----------------------------



```{r grafAper, }

#polarcolumn
 aperturas_graf<- map(unique(aperturas$Aperturas), function(niveles){
  highchart() %>%
  hc_chart(type = "column", polar = TRUE) %>% 
  hc_xAxis(categories = aperturas$Region,
  labels=list(distance=13)) %>% 
  hc_yAxis(labels=list (formatter = JS(paste0("function() {
                       return this.value + '%'
					   }"
					  )
		))) %>%
  hc_add_series(
     name = niveles,
     data = aperturas[aperturas$Aperturas== niveles,]$variación_mensual,
     colorByPoint = TRUE,
     type = "column",
     group = aperturas[aperturas$Aperturas== niveles,]$Region,
     showInLegend = FALSE,
	 dataLabels=  list(enabled = FALSE,inside=FALSE,format='{point.y:.1f}',y=-12,x= -7, padding=4)
   )%>%
   	 hc_title(text = niveles)%>%
	 hc_subtitle(text=paste0("Variación mensual - aperturas seleccionadas","-",str_to_title(format(max(ipcmensual$Período),"%B-%Y"))))%>%
    hc_tooltip(pointFormat =  "{series.name} <br>
      {point.y:.1f}%")%>%	
     hc_colors(coloresAperturas)%>%
  hc_credits(enabled = TRUE, text = "Fuente: INDEC",align = "right",verticalAlign = "bottom",
  style = list(color = "#2b908f", fontSize = '10px'),
             href = " https://www.indec.gob.ar/ftp/cuadros/economia/sh_ipc_08_22.xls")%>%
    hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)
})  
```

### Pan y cereales

```{r , }

aperturas_graf[[1]]

```

### Carnes y derivados

```{r , }

aperturas_graf[[2]]

```

### Leche, productos lácteos y huevos

```{r , }

aperturas_graf[[3]]

```

### Aceites, grasas y manteca

```{r , }

aperturas_graf[[4]]

```

### Frutas

```{r , }

aperturas_graf[[5]]

```

### Verduras, tubérculos y legumbres
```{r , }

aperturas_graf[[6]]

```

### Azúcar, dulces, chocolates, etc.

```{r , }

aperturas_graf[[7]]

```

### Café, té, yerba y cacao

```{r , }

aperturas_graf[[8]]

```

### Aguas minerales, bebidas gaseosas y jugos

```{r , }

aperturas_graf[[9]]

```
  
Distribución del ingreso y pobreza {data-navmenu="Índice de precios al consumidor e Ingresos"}
===================================== 

Row {.tabset .tabset-fade}
-------------------------------------


### Coef.Gini

```{r graf2, fig.width=6, fig.asp = 0.618 }
z<-ggplot(gini_ts3, aes(trimestre,gini)) +
geom_ribbon(aes(ymin=cilower, ymax=ciupper,group=1),alpha=0.5,fill="lightblue")+
geom_point(aes(y=cilower,colour="Intervalos de  Confianza-95%",group=1))+
geom_point(aes(y=ciupper,colour="Intervalos de  Confianza-95%",group=1))+
geom_line(aes(colour="Coeficiente de Gini", group=1))+
geom_point(aes(colour="Coeficiente de Gini", group=1))+
geom_text(aes(label=round(gini,2)),data=gini_ts3,nudge_y=0.13,size=2.8,alpha=1)+
labs(x="Trimestres",y="Coeficientes estimados (%)",colour="",linetype="",caption = "En base a datos obtenidos de la EPH-INDEC")+
theme_classic()+
scale_colour_manual(values=cols2)+
scale_x_date(breaks=trimestre,labels=trimestre2)+
theme(legend.position = c(.5, 1),
legend.background=element_blank(),
axis.ticks.x=element_line(colour="grey",size=0.5),
axis.text.x = element_text(angle=55, hjust = 1, vjust = 1),
panel.grid.major.y = element_line(colour = "grey", size = 0.1),
axis.ticks.y=element_blank(),
axis.line = element_blank())+
guides(colour =guide_legend(nrow = 2, override.aes = list(size = 2)))
```




```{r graf5}

highchart() %>%
hc_add_series(gini_ts3, type = "arearange",
                hcaes(x = trimestre2, low = cilower,
                      high =ciupper ),
                name="Intervalos de  Confianza-95%")%>%
hc_add_series(gini_ts3, type = "line", hcaes(x = trimestre2, y = gini),
                name="Coeficiente de Gini") %>%
hc_xAxis(type = "category",title=list(text = "Trimestres"))%>%
  hc_yAxis(title=list(text = "Porcentaje %"))%>% 
    hc_colors(cols6)%>%
   hc_tooltip(pointFormat =  "{series.name} <br>
   {point.y:.2f}% ")%>%
      hc_plotOptions(series=list(states=list(inactive=list(opacity= 0.6))))%>%
    hc_subtitle(text = "En base a datos obtenidos de la EPH-INDEC - Estimaciones vía Bootstrap de mil repeticiones.",
              align = "right",verticalAlign = "bottom", style = list(color = "#2b908f", fontSize = '10px'))%>%
    hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)
```

### Tasa de incidencia de la pobreza e indigencia- 2ndo Semestre 2021- Aglomerados


```{r preppob, include= FALSE  }
pobrezaaglo<-read.xlsx("bases/indicadores.xlsx", sheet=5,startRow=2,rowNames = TRUE)

#pobrezaaglo[31,]<-c(rep(".",4))


pobrezaaglo_footnote <- pobrezaaglo

row.names(pobrezaaglo_footnote)[31] <- paste0(row.names(pobrezaaglo_footnote)[31], 
                                footnote_marker_symbol(1))



pobrezareg<-read.xlsx("bases/indicadores.xlsx", sheet=6,startRow=2,rowNames = TRUE)

pobrezareg_footnote <- pobrezareg

row.names(pobrezareg_footnote)[7] <- paste0(row.names(pobrezareg_footnote)[7], 
                                footnote_marker_symbol(1))


```

```{r tabla3}
kable(pobrezaaglo,escape = F) %>%
kable_styling(bootstrap_options = c("bordered","condensed"),full_width= FALSE) %>%
  add_header_above(c(" " = 1, "Pobreza(%)" = 2,"Indigencia(%)" = 2 ))%>%
row_spec(1, bold = T, color = "white", background = "lightseagreen")%>%
column_spec( 1, width = "20em")%>%
column_spec( 2:5, width = "10em")%>%
footnote("INDEC", general_title="Fuente: ",footnote_as_chunk = F, title_format = c("italic", "underline"),fixed_small_size= T)



data.frame(row.names(pobrezaaglo),pobrezaaglo)%>% 
 downloadthis::download_this(
    output_name = "Tasas de incidencia y de pobreza",
    output_extension = ".xlsx",
    button_label = "Descargar la tabla en formato xlsx",
    button_type = "info",
    self_contained = FALSE, 
    has_icon = FALSE 
  )


```

### Pobreza e indigencia-2ndo semestre 2021-Regiones

```{r tabla4}
kable(pobrezareg,escape = F) %>%
kable_styling(bootstrap_options = c("bordered","condensed"),full_width= FALSE) %>%
  add_header_above(c(" " = 1, "Pobreza(%)" = 2,"Indigencia(%)" = 2 ))%>%
row_spec(1, bold = T, color = "white", background = "orangered")%>%
column_spec( 1, width = "20em")%>%
column_spec( 2:5, width = "10em")%>%
footnote("INDEC", general_title="Fuente: ",footnote_as_chunk = F, title_format = c("italic", "underline"),fixed_small_size= T)



data.frame(row.names(pobrezareg),pobrezareg)%>% 
 downloadthis::download_this(
    output_name = "Tasas de incidencia y de pobreza-regiones",
    output_extension = ".xlsx",
    button_label = "Descargar la tabla en formato xlsx",
    button_type = "info",
    self_contained = FALSE, 
    has_icon = FALSE 
  )


```


PIB  {data-navmenu="Producto"}
======================================================


### Serie completa PIB, PIB desestacionalizado. Miles de millones de pesos a precios de 2004.   Tendencia obtenida mediante filtro HP.

```{r graf3, include= FALSE  }

ppi<-300

png("tamaño completo.png", width=12*ppi, height=6*ppi,res=ppi,pointsize = 14)

print(ggplot(producto,aes(fecha1,PBI/1000,group=1,color="PIB"))+
geom_line()+
geom_point(color=cols3[1])+
geom_line(aes(y=PIB.DESEST/1000,color="PIB desestacionalizado"))+
geom_line(aes(y=(PBI.hp$trend)/1000,color="PIB tendencia"),linetype="dashed")+
geom_point(aes(y=PIB.DESEST/1000),color=cols3[2])+
geom_point(aes(y=(PBI.hp$trend)/1000),color=cols3[3])+
geom_vline(xintercept=producto$fecha1[4],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[8],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[12],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[16],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[20],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[24],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[28],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[32],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[36],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[40],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[44],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[48],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[52],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[56],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[60],color="grey",size=0.3,linetype="dashed")+
geom_vline(xintercept=producto$fecha1[64],color="grey",size=0.3,linetype="dashed")+
scale_x_date(name="Trimestres",breaks=producto$fecha1,labels=producto$Trimestre,sec.axis = sec_axis(~.,labels = scales::date_format("%Y"),breaks=seq(as.Date("2004-06-01"), length = 19, by = "12 months")))+
theme_classic()+
scale_colour_manual(name=" ",values=cols5)+
theme(legend.position = "bottom",
legend.background=element_blank(),
axis.ticks.x=element_blank(),
panel.grid.major.y = element_line(colour = "grey"),
axis.ticks.y=element_blank(),
axis.line = element_blank(),
axis.ticks.length=unit(0.2, "cm"))+
guides(colour =guide_legend(nrow = 1, override.aes = list(size = 2)))+
labs(y=" ", caption="Serie PIB, miles de millones de pesos a precios de 2004.   Tendencia obtenida mediante filtro HP.                                                                             Fuente:Cuentas Nacionales-INDEC")
)

dev.off()

```


```{r graf4 }

highchart() %>% 
  hc_add_series(producto, "line", hcaes(x = fecha3, y =(PBI.hp$trend)/1000 ),name="PIB tendencia",dashStyle = "Dot",lineWidth=0.3)%>%
  hc_add_series(producto, "line", hcaes(x = fecha3, y =PBI/1000 ),name="PIB",dashStyle ="ShortDash")%>%
  hc_add_series(producto, "line", hcaes(x = fecha3, y =PIB.DESEST/1000),name="PIB desestacionalizado",dashStyle = "ShortDashDotDot")%>%
  hc_xAxis(type = "category",title=list(text = "Trimestres"))%>%
  hc_yAxis(title=list(text = ""),max= 800)%>% 
  hc_plotOptions(
  line = list(                  
    marker = list(
      lineWidth = 1,
      radius=3,
      lineColor = "#ffffff"
    )
  )
)%>%   
  hc_tooltip(pointFormat =  "{series.name} <br>
                             {point.y:.3f} ")%>%
  hc_colors(cols7)%>%
    hc_subtitle(text = "Fuente: INDEC",
              align = "right",verticalAlign = "bottom", style = list(color = "#2b908f", fontSize = '8px'))%>%
    hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)%>% 
  hc_legend(align = "bottom", verticalAlign = "bottom",
            layout = "horizontal", x = 0, y = 20)


```



EMAE {data-orientation=columns data-navmenu="Producto"}
=========================================================


Column {data-width = 700}
-------------------------------------

### Índice EMAE, base 2004 = 100

```{r grafemae, }

highchart() %>% 
  hc_add_series(emae, "line", hcaes(x = Fecha, y =Tendencia_Ciclo ),name="Serie Tendencia-Ciclo",dashStyle = "DashDot")%>%
  hc_add_series(emae, "line", hcaes(x = Fecha, y =Original),name="Serie Original")%>%
  hc_add_series(emae, "line", hcaes(x = Fecha, y =Desestacionalizada),name="Serie Desestacionalizada",dashStyle ="ShortDash")%>%
  hc_xAxis(type = "datetime")%>%
  hc_yAxis(title=list(text = "Índice"))%>%    
  hc_tooltip(pointFormat =  "{series.name} <br>
                             {point.y:.3f}") %>%
  hc_plotOptions(series=list(states=list(inactive=list(opacity= 0.6))))%>%							 
  hc_colors(cols3)%>%
  hc_credits(enabled = TRUE, text = "Fuente: INDEC - Consultar aquí la serie completa y las variaciones porcentuales ",align = "right",verticalAlign = "bottom",
  style = list(color = "#2b908f", fontSize = '10px'),
             href = "https://www.indec.gob.ar/ftp/cuadros/economia/sh_emae_mensual_base2004.xls")%>%
    hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)

```
  
Column {tabset .tabset-fade}
-----------------------------------------------


### EMAE, descripción



El EMAE es un indicador provisorio de la evolución del PIB a precios constantes de 2004.
El indicador es un índice Laspeyres que ofrece una pauta del comportamiento de la actividad económica real con 
una frecuencia mayor a la del PIB trimestral a precios constantes. Su cálculo consiste en sumar el 
valor agregado a precios básicos de cada una de las actividades económicas más los impuestos netos de subsidios 
a los productos, utilizando las ponderaciones de las cuentas nacionales base 2004 de la República Argentina. 
[Leer la metodología aquí.](https://www.indec.gob.ar/ftp/cuadros/economia/metodologia_emae_ago_16.pdf)

Puede consultarse la serie completa desde 2004 [aquí](https://www.indec.gob.ar/ftp/cuadros/economia/sh_emae_actividad_base2004.xls) . Fuente: INDEC.

### Variación Desestacionalizada 


```{r boxes1,}

valueBox("1.1 %", caption = "Aumento del EMAE desestacionalizado de Junio-22 con respecto al mes anterior", icon="glyphicon-arrow-up",color="skyblue")

```

### Variación Acumulada

```{r boxes2,}

valueBox("6.3 %", caption = "Variación acumulada del año(2022) respecto al acumulado de igual periodo del año anterior", icon="glyphicon-arrow-up",color="orangered")

```



Valor agregado bruto a precios básicos {data-navmenu="Producto"}
======================================================

Row {.tabset .tabset-fade}
-------------------------------------

### VAB Segundo trimestre 2022


```{r , include= FALSE }
vab<-tibble(
  name = VAB[2:17,1],
  y = VAB[2:17,2] )

vab<-list_parse(vab)


vabvar<-tibble(
  name = VAB[1:17,1],
  y = VAB[1:17,3] )

vabvar<-list_parse(vabvar)

```

```{r graf15 }

highchart() %>%
  hc_chart(type = "bar") %>%
  hc_xAxis(type = "category") %>%
  hc_legend(enabled = FALSE) %>%
   hc_add_series(
    name = "VAB",
    colorByPoint = TRUE,
    data = vab
  ) %>%
hc_tooltip(pointFormat =  "{point.y:.3f} millones de pesos") %>%
hc_colors(cols8)%>%
hc_title(text=" Valor agregado bruto a precios básicos,por categorías, segundo trimestre del 2021",style = list(color = "black", fontSize = '14px')) %>%
hc_subtitle(text="El VAB total asciende a 644819 millones de pesos y se obtiene de restarle al PIB los impuestos netos de subsidios, IVA y derechos de importación. <br> INDEC - Datos preliminares. Millones de pesos de 2004. ",style = list(color = "#2b908f", fontSize = '10px')) %>%
  hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)

```

### VAB, variación interanual

```{r graf16 }

highchart() %>%
  hc_chart(type = "bar") %>%
  hc_xAxis(type = "category") %>%
  hc_legend(enabled = FALSE) %>%
   hc_add_series(
    name = "VAB%",
    colorByPoint = TRUE,
    data = vabvar
  ) %>%
hc_tooltip(pointFormat =  "{point.y:.2f} por ciento") %>%
hc_colors(c("black",cols8[-1]))%>%
hc_title(text=" Variación porcentual respecto al mismo trimestre del año anterior, categorías VAB.",style = list(color = "black", fontSize = '14px')) %>%
hc_subtitle(text="Fuente: INDEC - Datos preliminares. Segundo trimestre 2022. ",style = list(color = "#2b908f", fontSize = '10px'),align = "right") %>%
  hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)

```

Balanza comercial, acumulado en 2022 {data-navmenu="Comercio Exterior"}
=========================================================================


### Balanza comercial, primeros ocho meses de 2022

```{r , include= FALSE }


bc <- tibble(
  name = c("Exportaciones", "Importaciones", "Saldo Balanza Comercial"),
  y = c(export[1,2],import[1,2],export[1,2] - import[1,2] ),
  drilldown = tolower(name)
)

ds <- list_parse(bc)
names(ds) <- NULL


hc <- highchart() %>%
  hc_chart(type = "column") %>%
  hc_xAxis(type = "category") %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(
    series = list(
      boderWidth = 0,
      dataLabels = list(enabled = TRUE)
    )
  ) %>%
  hc_add_series(
    name = "Balanza Comercial, exportaciones e importaciones",
    colorByPoint = TRUE,
    data = ds
  )

impo <- tibble(
  name = c("Total","Bienes de capital", "Bienes intermedios", "Combustibles y lubricantes", "Piezas y accesorios para bienes de capital","Bienes de consumo","Vehículos automotores de pasajeros","Resto"),
  y = c(import[1,2],import[2,2],import[7,2],import[17,2],import[20,2],import[24,2],import[37,2],import[39,2]

),
  drilldown = tolower(name)
)

expo <- tibble(
  name = c("Total","Productos primarios", "Manufacturas de origen agropecuario (MOA)", "Manufacturas de origen industrial (MOI)", "Combustibles y energía"),
  y = c(export[1,2],export[2,2],export[15,2],export[32,2],export[47,2]

),
  drilldown = tolower(name)
)

balanza<-tibble(
name=c("Mercosur","Chile","Resto de ALADI","SICA","USMCA (ex NAFTA)","Unión Europea","Reino Unido",
"Suiza","CEI","ASEAN","China","República de Corea","Japón","India","Medio Oriente",
"Magreb y Egipto","SACU","Oceanía","Resto del Mundo"),
y = saldozonas[,4],
 drilldown = tolower(name)
)


pri<-tibble( 
 name = c(
  "Animales vivos",
  "Pescados y mariscos sin elaborar",
  "Miel",
  "Hortalizas y legumbres sin elaborar",
  "Frutas frescas",
  "Cereales",
  "Semillas y frutos oleaginosos",
  "Tabaco sin elaborar",
  "Lanas sucias",
  "Fibras de algodón",
  "Minerales metalíferos, escorias y cenizas",
  "Resto de productos primarios"),
y = c(export[3:14,2]


) )


moa<-tibble(
name = c("Carnes y sus preparados",
  "Pescados y mariscos elaborados",
  "Productos lácteos",
  "Otros productos de origen animal",
  "Frutas secas o procesadas",
  "Café, té, yerba mate y especias",
  "Productos de molinería y sus preparaciones",
  "Grasas y aceites",
  "Azúcar, cacao y artículos de confitería",
  "Preparados de hortalizas, legumbres y frutas",
  "Bebidas, líquidos alcohólicos y vinagre",
  "Residuos y desperdicios de la industria alimenticia",
  "Extractos curtientes y tintóreos",
  "Pieles y cueros",
  "Lanas elaboradas",
  "Resto de MOA"),
y=c(export[16:31,2]


))

moi<-tibble(
name= c(  "Productos químicos y conexos",
  "Materias plásticas y sus manufacturas",
  "Caucho y sus manufacturas",
  "Manufacturas de cuero, marroquinería, etc.",
  "Papel, cartón, impresos y publicaciones",
  "Textiles y confecciones",
  "Calzado y sus partes componentes",
  "Manufacturas de piedra, yeso, vidrio, etc.",
  "Piedras, metales preciosos y sus manufacturas, monedas",
  "Metales comunes y sus manufacturas",
  "Máquinas y aparatos, material eléctrico",
  "Material de transporte terrestre",
  "Vehículos de navegación aérea, marítima y fluvial",
  "Resto de MOI"),
y= c(export[33:46,2]


))



cye<-tibble(
name= c("Petróleo crudo",
  "Carburantes",
  "Grasas y aceites lubricantes",
  "Gas de petróleo, otros hidrocarburos gaseosos  y energía eléctrica",
  "Resto de combustibles"),
y= c(export[48:52,2]

))


bk<- tibble(
name= c("Máquinas, aparatos y material eléctrico; sus partes", 
"Material de transporte",
"Instrumentos de óptica, precisión, médico-quirúrgico, relojería y música",
"Resto de bienes de capital"),
y=c(import[3:6,2]


))

bi<-tibble(
name=c("Productos del reino vegetal", 
"Productos minerales",
"Productos de industrias químicas y conexas",
"Plástico, caucho y sus manufacturas",
"Pasta de madera, papel,cartón",
"Materias textiles y sus manufacturas",
"Manufacturas de piedra, yeso, cemento, amianto, mica, cerámica y vidrio",
"Metales comunes y sus manufacturas",
"Resto de bienes intermedios"),
y=c(import[8:16,2]


))


cyl<- tibble(
name=c("Productos minerales",
"Resto de combustibles y lubricantes"),
y=c(import[18:19,2]

))


pya<- tibble(
name=c("Máquinas, aparatos y material eléctrico; sus partes",
"Material de transporte",
"Resto de piezas y accesorios"),
y=c(import[21:23,2]

))

bco<-tibble(
name=c("Animales vivos y productos del reino animal", 
"Productos del reino vegetal", 
"Productos alimenticios, bebidas y tabaco", 
"Productos de industrias químicas y conexas", 
"Plástico, caucho y sus manufacturas", 
"Materias textiles y sus manufacturas",  
"Calzado, paraguas, fores artifciales y otros", 
"Máquinas, aparatos y material eléctrico; sus partes", 
"Material de transporte", 
"Instrumentos de óptica, precisión, médico-quirúrgico, relojería y música", 
"Mercancías y productos diversos",
"Resto de bienes de consumo"),
y=c(import[25:36,2]

))


merco<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[1,2],saldozonas[1,3]))

chile<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[2,2],saldozonas[2,3]))

aladi<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[3,2],saldozonas[3,3]))

sica<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[4,2],saldozonas[4,3]))

nafta<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[5,2],saldozonas[5,3]))

union<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[6,2],saldozonas[6,3]))

reino<- tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[7,2],saldozonas[7,3]))

medio<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[15,2],saldozonas[15,3]))

magreb<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[16,2],saldozonas[16,3]))

asean<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[10,2],saldozonas[10,3]))

china<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[11,2],saldozonas[11,3]))

corea<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[12,2],saldozonas[12,3]))

japon<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[13,2],saldozonas[13,3]))

india<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[14,2],saldozonas[14,3]))

suiza<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[8,2],saldozonas[8,3]))

cei<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[9,2],saldozonas[9,3]))

sacu<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[17,2],saldozonas[17,3]))

oceania<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[17,2],saldozonas[17,3]))

restom<-tibble(
name=c("Exportaciones","Importaciones"),
y=c(saldozonas[18,2],saldozonas[18,3]))







dbalanza<-list_parse(balanza)
dimpo<-list_parse(impo)
dexpo<-list_parse(expo)
dpri<-list_parse(pri)
dmoa<-list_parse(moa)
dmoi<-list_parse(moi)
dcye<-list_parse(cye)
dbk<-list_parse(bk)
dbi<-list_parse(bi)
dcyl<-list_parse(cyl)
dpya<-list_parse(pya)
dbco<-list_parse(bco)
dmerco<-list_parse(merco)
dchile<-list_parse(chile)
daladi<-list_parse(aladi)
dsica<-list_parse(sica)
dnafta<-list_parse(nafta)
dreino<-list_parse(reino)
dunion<-list_parse(union)
dmedio<-list_parse(medio)
dmagreb<-list_parse(magreb)
dasean<-list_parse(asean)
dchina<-list_parse(china)
dcorea<-list_parse(corea)
djapon<-list_parse(japon)
dindia<-list_parse(india)
dsuiza<-list_parse(suiza)
dcei<-list_parse(cei)
dsacu<-list_parse(sacu)
doceania<-list_parse(oceania)
drestom<-list_parse(restom)



```


```{r graf6 }


hc %>%
  hc_drilldown(
    allowPointDrilldown = TRUE,
    series = list(
      list(
        id = "saldo balanza comercial",
        data = dbalanza
      ),
      list(
        id = "mercosur",
        data = dmerco
      ),
      list(
        id = "chile",
        data = dchile
      ), 
      list(
        id = "resto de aladi",
        data = daladi
      ),
      list(
        id = "sica",
        data = dsica
      ),
      list(
        id = "nafta",
        data = dnafta
      ),
      list(
        id = "unión europea",
        data = dunion
      ),
      list(
        id = "reino unido",
        data = dreino
      ),
      list(
        id = "medio oriente",
        data = dmedio
      ),
      list(
        id = "magreb y egipto",
        data = dmagreb
      ),
      list(
        id = "asean",
        data = dasean
      ),
      list(
        id = "china",
        data = dchina
      ),
      list(
        id = "república de corea",
        data = dcorea
      ),
      list(
        id = "japón",
        data = djapon
      ),
      list(
        id = "india",
        data = dindia
      ),
      list(
        id = "suiza",
        data = dsuiza
      ),
      list(
        id = "cei",
        data = dcei
      ),
      list(
        id = "sacu",
        data = dsacu
      ),
      list(
        id = "oceanía",
        data = doceania
      ),
      list(
        id = "resto del mundo",
        data = drestom
      ),
      list(
        id = "exportaciones",
        data = dexpo
      ),
      list(
        id = "importaciones",
        data = dimpo
      ),
      list(
        id = "productos primarios",
        data = dpri
      ) ,
      list(
        id = "manufacturas de origen agropecuario (moa)",
        data = dmoa
      ) ,
      list(
        id = "manufacturas de origen industrial (moi)",
        data = dmoi
      ) ,
      list(
        id = "combustibles y energía",
        data = dcye
      ) ,
      list(
        id = "bienes de capital",
        data = dbk
      ),
      list(
        id = "bienes intermedios",
        data = dbi
      ),
      list(
        id = "combustibles y lubricantes",
        data = dcyl
      ),
      list(
        id = "piezas y accesorios para bienes de capital",
        data = dpya
      ),
      list(
        id = "bienes de consumo",
        data = dbco
      )       
)
  )%>%
hc_tooltip(pointFormat =  "{point.y} millones de dólares") %>%
  hc_colors(cols3)%>%
hc_title(text="Exportaciones por grandes rubros, importaciones por usos y agregados.Balanza comercial, por zonas económicas y países seleccionados. <br> Acumulado primeros ocho meses de 2022",style = list( fontSize = '12px')) %>%
hc_subtitle(text="INDEC - Datos Estimados. Millones de dólares. Cliquear para desplegar.",style = list(color = "#2b908f", fontSize = '10px')) %>%
  hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)

```

Saldo y comercio exterior total, por zona zona económica - 2022 {data-navmenu="Comercio Exterior"}
=================================================================================



```{r cof12,include=FALSE }

# La siguiente función la obtuve del repositorio de highcharter

hctreemapcolores = with(environment(hctreemap),
   ## Modified `hctreemap`
   ## names colorValue correctly for connection to `hc_colorAxis`
function (tm, ...) 
{
    assertthat::assert_that(is.list(tm))
    df <- tm$tm %>% tbl_df() %>% select_("-x0", "-y0", "-w", 
        "-h", "-stdErr", "-vColorValue") %>% rename_(value = "vSize", 
        colorValue = "vColor") %>% purrr::map_if(is.factor, as.character) %>% 
        data.frame(stringsAsFactors = FALSE) %>% tbl_df()
    ndepth <- which(names(df) == "value") - 1
    ds <- map_df(seq(ndepth), function(lvl) {
        df2 <- df %>% filter_(sprintf("level == %s", lvl)) %>% 
            rename_(name = names(df)[lvl]) %>% mutate_(id = "highcharter::str_to_id(name)")
        if (lvl > 1) {
            df2 <- df2 %>% mutate_(parent = names(df)[lvl - 1], 
                parent = "highcharter::str_to_id(parent)")
        }
        else {
            df2 <- df2 %>% mutate_(parent = NA)
        }
        df2
    })
    ds <- list_parse(ds)
    ds <- map(ds, function(x) {
        if (is.na(x$parent)) 
            x$parent <- NULL
        x
    })
    hc_add_series(highchart(), data = ds, type = "treemap", ...)
}
)




tm <- treemap(basezonas, index = c("Zona","País"),
              vSize = "Comercio.total", vColor = "saldo",
              type = "manual", palette = cols9,
              draw = FALSE)
mitree<- hctreemapcolores(tm, allowDrillToNode = TRUE,
                        layoutAlgorithm = "squarified",
                        levelIsConstant = FALSE,
    levels = list(
      list(level = 1, dataLabels = list(enabled = TRUE)),
      list(level = 2, dataLabels = list(enabled = FALSE))))%>% 
hc_colorAxis(minColor =cols9[1],
               maxColor = cols9[13],enabled = TRUE)%>%
  hc_title(text="Saldo balanza comercial e intercambio total, por zona económica y país. Acumulado 2022")%>%
  hc_subtitle(text = "Datos estimados. Millones de dolares. Estados Unidos incluye Puerto Rico y territorios asociados, China a Macao, Chile, Uruguay y Brasil, sus zonas francas.") %>% 
  hc_credits(enabled=TRUE, text= " Fuente: INDEC. Sistema de Consulta del Comercio Exterior de Bienes ",href = "https://comex.indec.gob.ar") %>%
hc_tooltip(pointFormat = "<b>{point.name}</b>:<br>
                             Comercio total: {point.value:,.0f}<br>
                             Saldo comercial: {point.colorValue:,.0f}")

```							 
							 
```{r graf12,echo=FALSE }


mitree

```

Total comerciado, por país y continente - 2022 {data-navmenu="Comercio Exterior"}
=================================================================================


## Saldo balanza comercial e intercambio total, por continente y país. Acumulado 2022



```{r cont, include=FALSE }


continente<-arrange(basezonas, (Continente))
continente<-continente[,1:5]

continente[nrow(continente)+1,1]<-"Totales"
continente[nrow(continente),2:5]<-rbind(c(colSums(continente[,2:5],,na.rm=TRUE)))

continente2<-arrange(basezonas, (Continente))
continente2<-continente2[,1:6]

continente2[nrow(continente2)+1,1]<-"Totales"
continente2[nrow(continente2),6]<-"Totales"
continente2[nrow(continente2),2:5]<-rbind(c(colSums(continente2[,2:5],na.rm=TRUE)))

continente3<-arrange(basezonas, (Continente))
continente3<-continente3[,1:6]


spanish<-'{
	"sProcessing":     "Procesando...",
	"sLengthMenu":     "Mostrar _MENU_ filas - Acumulado 2022",
	"sZeroRecords":    "No se encontraron resultados",
	"sEmptyTable":     "Ningún dato disponible en esta tabla",
	"sInfo":           "Mostrando fila número _START_ a la _END_ de un total de _TOTAL_ filas",
	"sInfoEmpty":      "Mostrando filas del 0 al 0 de un total de 0 filas",
	"sInfoFiltered":   "(filtrado de un total de _MAX_ filas)",
	"sInfoPostFix":    "",
	"sSearch":         "Buscar:",
	"sUrl":            "",
	"sInfoThousands":  ",",
	"sLoadingRecords": "Cargando...",
     	"oPaginate": {
		"sFirst":    "Primero",
		"sLast":     "Último",
		"sNext":     "Siguiente",
		"sPrevious": "Anterior"
	},
	"oAria": {
		"sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
		"sSortDescending": ": Activar para ordenar la columna de manera descendente"
	}
}'

```

```{r tabla8 , include= FALSE,eval=FALSE}
kable(continente,digits = 3 ,col.names=c("País / Continente","Exportaciones","Importaciones","Saldo","Comercio total"),caption="Saldo balanza comercial e intercambio total, por continente y país. Acumulado 2022") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive"), full_width = F,fixed_thead = list(enabled = T, background = "skyblue")) %>%
  pack_rows("África", 1, 45, label_row_css = "background-color: #666; color: #fff;")%>%
  pack_rows("América", 46, 83, label_row_css = "background-color: #666; color: #fff;")%>%
  pack_rows("Asia", 84, 127, label_row_css = "background-color: #666; color: #fff;")%>%
  pack_rows("Europa", 128, 173, label_row_css = "background-color: #666; color: #fff;")%>%
  pack_rows("Indeterminado", 174, 175, label_row_css = "background-color: #666; color: #fff;")%>%
  pack_rows("Oceanía", 176, 182, label_row_css = "background-color: #666; color: #fff;")%>%
row_spec(183, bold = T, color = "black", background = "skyblue")%>%
column_spec(1:5, width = "10cm")%>%
footnote(general ="Fuente: INDEC. Datos estimados. Millones de dolares.
Estados Unidos incluye Puerto Rico y territorios asociados, China a Macao, Chile, Uruguay y Brasil, sus zonas francas.",
 general_title = "Nota: ",title_format = c("italic", "underline"),footnote_as_chunk = T,fixed_small_size = TRUE)

```




```{r tabla9 }



datatable(continente2,rownames = FALSE,colnames = c("Continente / País","Exportaciones","Importaciones","Saldo","Comercio total","Continente"),
class="compact display",extensions = c('RowGroup','Buttons','FixedHeader','Responsive'),
options = list(columnDefs = list(list(targets = 5, visible = FALSE),list(className = 'dt-center',targets = 0)),
rowGroup = list(dataSrc = 5),pageLength = 25, searching=T,
dom = 'Blfrtip',
buttons = list(
              list(
                  extend = "copy",
                  text = "Copiar",
				  className = "copiar"
                  ),
              list(
        extend = 'collection',
        buttons = c('csv', 'excel', 'pdf'),
        text = 'Descargar',
		className = "descargar"
      ),
              list(
                  extend = "print",
                  text = "Imprimir",
				  className = "imprimir"
                  )),fixedHeader = TRUE,
lengthMenu = c(25, 50, 100,200),
language = fromJSON(spanish)))%>% formatRound(2:5, 3)%>%
formatStyle(
  1,
  target = 'row',
  backgroundColor = styleEqual("Totales", "lightblue", default = "")
) 
```

Row {data-height=100}
-------------------------------------

- Fuente: [INDEC](https://comex.indec.gob.ar/) - Sistema de consulta de comercio exterior .
- Datos Estimados.  Millones de dólares. 
- Estados Unidos incluye Puerto Rico y territorios asociados, China a Macao. Chile, Uruguay y Brasil, sus zonas francas.
- Última actualización: 22/9/2022.





Resultado Fiscal, base caja  {data-navmenu="Resultado Fiscal"}
=================================================================================

Row {.tabset .tabset-fade}
-------------------------------------

### Agosto 2022

```{r , include= FALSE }

rf <- tibble(
  name = c("Ingresos Totales", "Gastos Primarios", "Resultado Primario","Intereses Netos","Resultado Financiero"),
  y = c(basecaja[1,2],basecaja[21,2] ,basecaja[63,2],basecaja[64,2],basecaja[65,2]),
  drilldown = tolower(name)
)

rfc <- list_parse(rf)
names(rfc) <- NULL


hcrs <- highchart() %>%
  hc_chart(type = "column") %>%
  hc_xAxis(type = "category") %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(
    series = list(
      boderWidth = 0,
      dataLabels = list(enabled = TRUE)
    )
  ) %>%
  hc_add_series(
    name = "Resultado Fiscal- Base Caja",
    colorByPoint = TRUE,
    data = rfc
  ) %>% hc_credits(enabled = TRUE, text = " Secretaría de Hacienda. Datos Preliminares.",position = list(align = "left",verticalAlign = "bottom", x=2),
  style = list(color = "#2b908f", fontSize = '8px'),href = "https://www.argentina.gob.ar/sites/default/files/2022/09/ago-22.xlsx")



IT<-tibble(name=c(basecaja[2,1],basecaja[12,1],basecaja[16,1],basecaja[20,1]),
y=c(basecaja[2,2],basecaja[12,2],basecaja[16,2],basecaja[20,2]),
drilldown = tolower(name))


GP<-tibble(name=c(basecaja[22,1],basecaja[44,1]),
y=c(basecaja[22,2],basecaja[44,2]),
drilldown = tolower(name))


GCP<-tibble(name=c(basecaja[23,1],basecaja[30,1],basecaja[34,1],basecaja[37,1],basecaja[42,1],basecaja[43,1]),
y=c(basecaja[23,2],basecaja[30,2],basecaja[34,2],basecaja[37,2],basecaja[42,2],basecaja[43,2]),
drilldown = tolower(name))


GC<-tibble(name=c(basecaja[45,1],basecaja[48,1],basecaja[51,1],basecaja[54,1],basecaja[57,1],basecaja[60,1]),
y=c(basecaja[45,2],basecaja[48,2],basecaja[51,2],basecaja[54,2],basecaja[57,2],basecaja[60,2]))


Tri<-tibble(name=c(basecaja[3:11,1]),
y=c(basecaja[3:11,2]))

Ren<-tibble(name=c(basecaja[13:15,1]),
y=c(basecaja[13:15,2]))

oic<-tibble(name=c(basecaja[17:19,1]),
y=c(basecaja[17:19,2]))


pre<-tibble(name=c(basecaja[24:29,1]),
y=c(basecaja[24:29,2]))


sub<-tibble(name=c(basecaja[31:33,1]),
y=c(basecaja[31:33,2]))

gas<-tibble(name=c(basecaja[35:36,1]),
y=c(basecaja[35:36,2]))

transc<-tibble(name=c(basecaja[38:41,1]),
y=c(basecaja[38:41,2]))





dIT<-list_parse(IT)
dGP<-list_parse(GP)
dGCP<-list_parse(GCP)
dGC<-list_parse(GC)

dTri<-list_parse(Tri)
dRen<-list_parse(Ren)
doic<-list_parse(oic)
dpre<-list_parse(pre)
dsub<-list_parse(sub)
dgas<-list_parse(gas)
dtransc<-list_parse(transc)

```


```{r graf13 }

hcrs %>%
  hc_drilldown(
    allowPointDrilldown = TRUE,
    series = list(
      list(
        id = "ingresos totales",
        data = dIT
      ) ,
      list(
        id = "gastos primarios",
        data = dGP
      ) ,
      list(
        id = "gastos corrientes primarios",
        data = dGCP
      ) ,
      list(
        id = "gastos de capital",
        data = dGC
      ),
      list(
        id = "tributarios",
        data = dTri
      ),
      list(
        id = "rentas de la propiedad ",
        data = dRen
      ),
      list(
        id = "otros ingresos corrientes",
        data = doic
      ),
      list(
        id = "prestaciones sociales",
        data = dpre
      ),
      list(
        id = "subsidios económicos",
        data = dsub
      ),
      list(
        id = "gastos de funcionamiento y otros",
        data = dgas
      ),
      list(
        id = "transferencias corrientes a provincias",
        data = dtransc
      ) 
)
  )%>%
hc_tooltip(pointFormat =  "{point.y} millones de pesos") %>%
hc_colors(cols12[7:12])%>%
hc_title(text="Resultado Fiscal- Base Caja- Agosto 2022.Millones de pesos",style = list( fontSize = '13px')) %>%
hc_subtitle(text="     Para conocer en mayor detalle los rubros que componen los ingresos totales y gastos primarios,cliquee sobre las columnas. <br> El resultado financiero se obtiene de restarle al resultado primario (IT-GP) los intereses netos.",style = list(color = "#2b908f", fontSize = '10px')) %>%
  hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)


```


### Variaciones anuales

```{r , include= FALSE }

rf2 <- tibble(
  name = c("Ingresos Totales", "Gastos Primarios", "Resultado Primario","Intereses Netos","Resultado Financiero"),
  y = c(basecaja[1,3],basecaja[21,3] ,basecaja[63,3],basecaja[64,3],basecaja[65,3]),
  drilldown = tolower(name)
)

rfs2 <- list_parse(rf2)
names(rfs2) <- NULL


hcrs2 <- highchart() %>%
  hc_chart(type = "column") %>%
  hc_xAxis(type = "category") %>%
  hc_legend(enabled = FALSE) %>%
  hc_plotOptions(
    series = list(
      boderWidth = 0,
      dataLabels = list(enabled = TRUE)
    )
  ) %>%
  hc_add_series(
    name = "Resultado Fiscal- Base Caja",
    colorByPoint = TRUE,
    data = rfs2
  ) %>% hc_credits(enabled = TRUE, text = " Secretaría de Hacienda.  Datos Preliminares.",position = list(align = "left",verticalAlign = "bottom", x=2),
  style = list(color = "#2b908f", fontSize = '8px'),href = "https://www.argentina.gob.ar/sites/default/files/2022/09/ago-22.xlsx")



IT2<-tibble(name=c(basecaja[2,1],basecaja[12,1],basecaja[16,1],basecaja[20,1]),
y=c(basecaja[2,3],basecaja[12,3],basecaja[16,3],basecaja[20,3]),
drilldown = tolower(name))


GP2<-tibble(name=c(basecaja[22,1],basecaja[44,1]),
y=c(basecaja[22,3],basecaja[44,3]),
drilldown = tolower(name))


GCP2<-tibble(name=c(basecaja[23,1],basecaja[30,1],basecaja[34,1],basecaja[37,1],basecaja[42,1],basecaja[43,1]),
y=c(basecaja[23,3],basecaja[30,3],basecaja[34,3],basecaja[37,3],basecaja[42,3],basecaja[43,3]),
drilldown = tolower(name))


GC2<-tibble(name=c(basecaja[45,1],basecaja[48,1],basecaja[51,1],basecaja[54,1],basecaja[57,1],basecaja[60,1]),
y=c(basecaja[45,3],basecaja[48,3],basecaja[51,3],basecaja[54,3],basecaja[57,3],basecaja[60,3]))


Tri2<-tibble(name=c(basecaja[3:11,1]),
y=c(basecaja[3:11,3]))

Ren2<-tibble(name=c(basecaja[13:15,1]),
y=c(basecaja[13:15,3]))

oic2<-tibble(name=c(basecaja[17:19,1]),
y=c(basecaja[17:19,3]))


pre2<-tibble(name=c(basecaja[24:29,1]),
y=c(basecaja[24:29,3]))


sub2<-tibble(name=c(basecaja[31:33,1]),
y=c(basecaja[31:33,3]))

gas2<-tibble(name=c(basecaja[35:36,1]),
y=c(basecaja[35:36,3]))

transc2<-tibble(name=c(basecaja[38:41,1]),
y=c(basecaja[38:41,3]))





dIT2<-list_parse(IT2)
dGP2<-list_parse(GP2)
dGCP2<-list_parse(GCP2)
dGC2<-list_parse(GC2)

dTri2<-list_parse(Tri2)
dRen2<-list_parse(Ren2)
doic2<-list_parse(oic2)
dpre2<-list_parse(pre2)
dsub2<-list_parse(sub2)
dgas2<-list_parse(gas2)
dtransc2<-list_parse(transc2)

```


```{r graf14 }

hcrs2 %>%
  hc_drilldown(
    allowPointDrilldown = TRUE,
    series = list(
      list(
        id = "ingresos totales",
        data = dIT2
      ) ,
      list(
        id = "gastos primarios",
        data = dGP2
      ) ,
      list(
        id = "gastos corrientes primarios",
        data = dGCP2
      ) ,
      list(
        id = "gastos de capital",
        data = dGC2
      ),
      list(
        id = "tributarios",
        data = dTri2
      ),
      list(
        id = "rentas de la propiedad ",
        data = dRen2
      ),
      list(
        id = "otros ingresos corrientes",
        data = doic2
      ),
      list(
        id = "prestaciones sociales",
        data = dpre2
      ),
      list(
        id = "subsidios económicos",
        data = dsub2
      ),
      list(
        id = "gastos de funcionamiento y otros",
        data = dgas2
      ),
      list(
        id = "transferencias corrientes a provincias",
        data = dtransc2
      ) 
)
  )%>%
hc_tooltip(pointFormat =  "{point.y} millones de pesos") %>%
hc_colors(cols13[2:7])%>%
hc_title(text="Resultado Fiscal- Base Caja-Agosto 2022- Variaciones anuales en millones de pesos",style = list( fontSize = '13px')) %>%
hc_subtitle(text="     Para conocer en mayor detalle las variaciones de los rubros que componen los ingresos totales y gastos primarios,cliquee sobre las columnas.",style = list(color = "#2b908f", fontSize = '10px')) %>%
  hc_exporting(enabled = TRUE) %>% hc_add_theme(temaclásico)


```

Origen provincial de las exportaciones y complejos exportadores - 2021 {data-orientation=columns data-navmenu="Comercio Exterior"}
==================================================================================================================================

Column {data-width = 500}
-------------------------------------


### Exportaciones por grandes rubros: PP, CyE, MOA y MOI.

```{r origen , include= FALSE , warn= FALSE}

dta_clss<-regiones %>% 
  group_by(Regiones) %>% 
  summarise(value = sum(Expo.Totales)) %>% 
  arrange(value) %>% 
  rename(name = Regiones, from = value) %>% 
  mutate(to = from + 500) %>% 
  mutate(color = cols14)%>% 
  mutate(name = paste0(name," : ",from, " mill. USD")) %>%
  list_parse()


regiones<- left_join(regiones, regiones %>% 
  group_by(Regiones) %>% 
  summarise(value = sum(Expo.Totales)),by = "Regiones")

regiones<-rename(regiones,ExpoToT=Expo.Totales)
regiones<-regiones %>% arrange(Provincias)


nombre<- numeric()

for (i in 1:24) {
nombre[i]<- provincias$`features`[[i]]$`properties`$iso_nombre
}


longitud<- numeric()

for (i in 1:24) {
longitud[i]<- provincias$`features`[[i]]$geometry$`coordinates`[[1]]
}

latitud<- numeric()

for (i in 1:24) {
latitud[i]<- provincias$`features`[[i]]$geometry$`coordinates`[[2]]
}


provincia<-tibble(name=nombre,lat=latitud,lon=longitud)
provincia<- provincia %>%
arrange(name)
provincia<-provincia %>% mutate(z = regiones$ExpoToT)


provincia$lat[23]<- -54.75071 # "y" es latitud
provincia$lon[23]<- -66.73785 # "x" es longitud


provincia$PP<-regiones$PP
provincia$MOA<-regiones$MOA
provincia$MOI<-regiones$MOI
provincia$CYE<-regiones$CYE

```


```{r mapa, echo=FALSE }

highchart(type="map") %>%
hc_add_series(mapData = argentina,regiones,joinBy = c("name", "Provincias"),name="Región",
value="value",showInLegend = TRUE,
borderColor = "#FAFAFA",
  borderWidth = 0.1,tooltip = list(useHTML = TRUE,
      pointFormat = "<b><i>{point.Regiones}</i></b>"))%>%
hc_add_series(
    data = provincia, 
    type = "mapbubble",
    name = "Detalle-Provincias", 
    minSize = "1%",
    maxSize = "8%",
    color="red",
    showInLegend = TRUE,
    tooltip = list(useHTML = TRUE,
      pointFormat = "<b><i>{point.name}</i></b> <br>
      <b>Exportaciones totales</b> {point.z:,.2f} mill. USD <br>
      <b>PP:</b> {point.PP:,.2f} mill. USD <br> 
      <b>MOA:</b> {point.MOA:,.2f} mill. USD <br>
      <b>MOI:</b> {point.MOI:,.2f} mill. USD <br>
      <b>CyE:</b> {point.CYE:,.2f} mill. USD",
	 allowPointSelect= TRUE)
  )%>%
hc_subtitle(text=" <b>Exportaciones por regiones económicas y provincias, grandes rubros. </b>",
 align = "center")%>%
 hc_legend(
    layout = "vertical",
    align = "right",
    verticalAlign = "bottom",
    floating = TRUE,
    x = 10,
    y = -20,
bubbleLegend = list(
            enabled = "TRUE",
            sizeBy = "width",
            ranges = list(list(color='#e4d354'), list(), list()),
            labels= list(format="{value:.2f} mill. USD"))) %>%
hc_colorAxis(
    dataClassColor = "category",
    dataClasses = dta_clss
    ) %>%
hc_yAxis(gridLineWidth=0)%>%
hc_xAxis(labels=list(enabled=FALSE), minorGridLineWidth= 0,minorTickLength= 0,tickLength= 0)%>%
hc_credits(enabled=TRUE, text="Segundo semestre 2021.Fuente: INDEC", position =list( align ="left", x=20))


```

Column {data-width = 500}
-------------------------------------

### Complejos Exportadores

```{r , include=FALSE  , warn=FALSE }

complejos<-complejos[-c(1,2,7,12,17,24,32),-2]

complejos<-complejos %>%
pivot_longer(-Complejos,names_to= "Regiones",values_to= "Exportaciones")

tm3 <- treemap(complejos, index = c("Complejos","Regiones"),
              vSize = "Exportaciones",vColor="Exportaciones",
              type = "manual", palette = cols15,draw = FALSE)


complejostree<- hctreemapcolores(tm3, allowDrillToNode = TRUE,
                        layoutAlgorithm = "squarified",
                        levelIsConstant = FALSE,
    levels = list(
      list(level = 1, dataLabels = list(enabled = TRUE)),
      list(level = 2, dataLabels = list(enabled = FALSE))))%>% 
hc_colorAxis(minColor =cols15[1],
               maxColor = cols15[20],enabled = TRUE)%>%
  hc_title(text="Complejos exportadores, desagregados por regiones económicas. Acumulado 2ndo. semestre del 2021")%>%
  hc_subtitle(text = "Datos estimados. Millones de dolares. Cliquear para conocer el detalle.") %>% 
  hc_credits(enabled=TRUE, text= " Fuente: INDEC.  Dirección Nacional de Estadísticas del Sector Externo ",href = "https://www.indec.gob.ar/ftp/cuadros/economia/opex_anexo_cuadros.xls") %>%
hc_tooltip(pointFormat = "<b>{point.name}</b>:<br>
                             Exportaciones: {point.value:,.0f} millones de dólares")
							 
```

```{r complejosgraf, echo = FALSE}

complejostree


```
